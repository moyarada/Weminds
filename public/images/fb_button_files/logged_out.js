var Bumper=Class.create({_bumpedForm:null,_lastModal:null,_refreshTimer:null,init:function(){var a=this;$("form.ajax").live("submit",this,function(b){return b.data.__onSubmit(b)});$("body").live("bumper:success",this,function(b){return b.data.__onBumpSuccess(b)});$("body").live("bumper:force:signup",this,function(b){return b.data.__onSignupForce(b)});$("#bumper_refresh_cancel").live("click",this,function(b){return b.data.__onRefreshCancel(b)})},login:function(){Bumper.hasAuthenticated=true;this._doHeaderUpdate()},_skipBump:function(a){return(Bumper.hasAuthenticated||a.hasClass("no_bump")||(a.hasClass("validate")&&!Validator.validate(a)))},_doModalShuffle:function(a){this._lastModal=$("#modal").children()},_doPageReset:function(){if(this._lastModal){$("#modal").addClass("refresh_on_close");$("#modal").find(".bump_content").remove();this._lastModal.show()}else{$("#modal").dialog("close")}},_doHeaderUpdate:function(){$("#header_user").hide();$("#header_user").load("/users/header_menu",function(){$("#header_user").fadeIn()})},_doCurtain:function(){if(this._lastModal){return}doCurtain("<h3>Howdy and Thanks for getting your login on!</h3><br/>Your page should refresh in a few seconds to fetch you the latest data. If it doesn't you can <a href=\""+window.location.href+'" class="refresh">click here to refresh</a>. If you don\'t want refresh for some strange reason, <a href="#" id="bumper_refresh_cancel">click here</a>',1000,750);this._refreshTimer=setTimeout("window.location.reload(true);",11000)},__onRefreshCancel:function(a){a.preventDefault();clearTimeout(this._refreshTimer);$("#curtain").animate({opacity:1},1000).slideUp(750,"easeOutExpo")},__onSubmit:function(d){var c=$(d.target).closest("form");if(this._skipBump(c)){return true}d.preventDefault();d.stopPropagation();d.stopImmediatePropagation();this._bumpedForm=c;var b=this;var a="/user_sessions/bump";$.ajax({url:a,data:{in_state:true},success:function(e){_gaq.push(["_trackPageview",a]);b.__onBumpFetch(e)}});return false},__onBumpFetch:function(a){if(!$("#modal").is(":visible")){launch_modal(a)}else{this._lastModal=$("#modal").children();this._lastModal.hide();$("#modal").append('<div class="bump_content">'+a+"</div>")}},__onBumpSuccess:function(b){Bumper.hasAuthenticated=true;if(this._bumpedForm){this._bumpedForm.submit();this._doPageReset();this._doHeaderUpdate();this._doCurtain()}else{var a=$("#after_url").val()||"/";window.location.href=a}},__onSignupForce:function(a){if($("#modal").is(":visible")){$("#modal").find(".bump_register_link").trigger("click")}else{$("body").append('<a href="/users/new" class="fetch modal" style="display: none;" id="force_signup_in_modal"></a>');$("#force_signup_in_modal").trigger("click")}}});Bumper.hasAuthenticated=false;Bumper.create=function(){if(window.__bumper__){return}window.__bumper__=new Bumper()};Bumper.create();Bumper.getInstance=function(){return window.__bumper__};if(pageQueryString.redirect_after_login){$(function(){$("#splash_login_link").click()})};